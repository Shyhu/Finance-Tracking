<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: sans-serif; font-size: 12px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #444; padding: 6px; text-align: center; }
        th { background-color: #f0f0f0; }
        h2 { color: #333; }
    </style>
</head>
<body>
    <h2>Loan Details - {{ loan.project.name }}</h2>
    <p><strong>Loan Purpose:</strong> {{ loan.loan_purpose }}</p>
    <p><strong>Amount:</strong> ${{ loan.amount }}<br>
       <strong>Interest Rate:</strong> {{ loan.interest_rate }}%<br>
       <strong>Start Date:</strong> {{ loan.start_date }}</p>
    <p><strong>Total Interest Paid:</strong> ${{ total_interest_paid }}<br>
       <strong>Total Principal Paid:</strong> ${{ total_principal_paid }}<br>
       <strong>Remaining Balance:</strong> ${{ remaining_balance }}</p>

    <h3>Repayment History</h3>
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Amount Paid</th>
                <th>Interest Paid</th>
                <th>Principal Paid</th>
                <th>Balance After</th>
            </tr>
        </thead>
        <tbody>
            {% for row in repayments %}
            <tr>
                <td>{{ row.repayment.date }}</td>
                <td>${{ row.repayment.amount_paid|floatformat:2 }}</td>
                <td>${{ row.repayment.interest_paid|floatformat:2 }}</td>
                <td>${{ row.repayment.principal_paid|floatformat:2 }}</td>
                <td>${{ row.balance_after|floatformat:2 }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>
