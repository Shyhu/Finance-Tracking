{% extends 'base.html' %}
{% load static %}
{% block content %}
<style>
  
  .table th, .table td {
    vertical-align: middle;
  }
  .modal-title {
    font-weight: bold;
  }
  .btn-primary {
    background: linear-gradient(to right,rgb(79, 163, 232),rgb(46, 94, 139));
    border: none;
  }
  .btn-primary:hover {
    background: linear-gradient(to right, #2E8B57, #4CAF50);
  }
  .form-control, .form-select {
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease-in-out;
  }
  .form-control:focus, .form-select:focus {
    border-color: #4CAF50;
    box-shadow: 0 0 5px rgba(76, 175, 80, 0.6);
  }
  .fade-in {
    animation: fadeIn 0.6s ease-in-out both;
  }
  @keyframes fadeIn {
    0% {opacity: 0; transform: translateY(10px);}
    100% {opacity: 1; transform: translateY(0);}
  }
  
  @media (max-width: 768px) {
    .table-responsive {
      overflow-x: auto;
    }
    .form-label, .form-control, .form-select {
      font-size: 12px;
    }
    .btn span {
      display: none;
    }
    .btn i {
      margin-right: 0;
    }
    .page-title {
      font-size: 1.25rem;
    }
  }
  @media (max-width: 575.98px) {
    .modal-dialog {
      margin: 1rem;
    }
    .modal-content {
      border-radius: 1rem;
      font-size: 12px;
    }
    .modal-body, .modal-header, .modal-footer {
      padding: 1rem;
    }
  }


  /* Enhanced Loan Management Single Card Styling */
  .loan-management-container {
    font-family: 'Roboto', sans-serif;
    font-size: 12px;
  }

  /* Main Loan Management Card */
  .loan-management-card {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(248, 250, 252, 0.98) 100%);
    backdrop-filter: blur(25px);
    border-radius: 25px;
    margin: 20px auto 40px auto;
    max-width: 1400px;
    box-shadow: 
      0 30px 60px rgba(59, 130, 246, 0.15),
      0 20px 40px rgba(0, 0, 0, 0.08),
      inset 0 1px 0 rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(59, 130, 246, 0.1);
    position: relative;
    overflow: hidden;
    transform: translateZ(15px);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    animation: slideInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .loan-management-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #3b82f6, #60a5fa, #93c5fd, #10b981, #f59e0b, #ef4444, #3b82f6);
    background-size: 400% 100%;
    animation: gradientFlow 5s ease-in-out infinite;
    border-radius: 25px 25px 0 0;
  }

  .loan-management-card::after {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(59, 130, 246, 0.03) 0%, transparent 70%);
    animation: floatGlow 12s ease-in-out infinite;
    pointer-events: none;
  }

  .loan-management-card:hover {
    transform: translateZ(20px);
    box-shadow: 
      0 35px 70px rgba(59, 130, 246, 0.2),
      0 25px 50px rgba(0, 0, 0, 0.12),
      inset 0 1px 0 rgba(255, 255, 255, 0.95);
  }

  /* Card Content */
  .loan-card-content {
    padding: 35px 40px;
    position: relative;
    z-index: 2;
  }

  /* Header Section */
  .loan-header-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 25px;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 2px solid rgba(59, 130, 246, 0.1);
    position: relative;
  }

  .loan-header-section::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 2px;
    background: linear-gradient(90deg, #3b82f6, #60a5fa);
    border-radius: 1px;
  }

  .loan-title-section {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .loan-title-icon-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    border-radius: 18px;
    box-shadow: 
      0 12px 30px rgba(59, 130, 246, 0.3),
      0 6px 15px rgba(0, 0, 0, 0.1);
    transform: translateZ(8px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }

  .loan-title-icon-wrapper::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.6s ease;
  }

  .loan-title-icon-wrapper:hover {
    transform: translateZ(12px) translateY(-3px) rotateY(10deg);
    box-shadow: 
      0 18px 40px rgba(59, 130, 246, 0.4),
      0 10px 25px rgba(0, 0, 0, 0.15);
  }

  .loan-title-icon-wrapper:hover::before {
    left: 100%;
  }

  .loan-title-icon {
    font-size: 28px;
    color: #ffffff;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
  }

  .loan-page-title {
    font-family: 'Roboto', sans-serif;
    font-size: 32px;
    font-weight: 700;
    color: #1e40af;
    margin: 0;
    text-shadow: 0 2px 4px rgba(59, 130, 246, 0.1);
    letter-spacing: -0.5px;
    position: relative;
  }

  .loan-page-title::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 0;
    width: 0;
    height: 3px;
    background: linear-gradient(90deg, #3b82f6, #60a5fa);
    border-radius: 2px;
    transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .loan-header-section:hover .loan-page-title::after {
    width: 100%;
  }

  .loan-action-buttons {
    display: flex;
    gap: 15px;
    align-items: center;
  }

  .btn-loan-dashboard {
    font-family: 'Roboto', sans-serif;
    font-size: 12px;
    font-weight: 600;
    padding: 14px 28px;
    border-radius: 14px;
    border: none;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    cursor: pointer;
    transform: translateZ(5px);
  }

  .btn-loan-dashboard::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.6s ease;
  }

  .btn-loan-dashboard:hover::before {
    left: 100%;
  }

  .btn-loan-pdf {
    background: rgba(255, 255, 255, 0.9);
    color: #374151;
    border: 2px solid rgba(59, 130, 246, 0.2);
    box-shadow: 0 8px 20px rgba(59, 130, 246, 0.1);
  }

  .btn-loan-pdf:hover {
    background: rgba(59, 130, 246, 0.05);
    border-color: rgba(59, 130, 246, 0.4);
    color: #1e40af;
    transform: translateZ(10px) translateY(-3px);
    box-shadow: 0 12px 30px rgba(59, 130, 246, 0.2);
    text-decoration: none;
  }

  .btn-loan-filter {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: #ffffff;
    box-shadow: 0 10px 25px rgba(245, 158, 11, 0.3);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .btn-loan-filter:hover {
    transform: translateZ(10px) translateY(-3px);
    box-shadow: 0 15px 35px rgba(245, 158, 11, 0.4);
    color: #ffffff;
    text-decoration: none;
  }

  .btn-loan-filter.active {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    box-shadow: 0 10px 25px rgba(239, 68, 68, 0.3);
  }

  .btn-loan-filter.active:hover {
    box-shadow: 0 15px 35px rgba(239, 68, 68, 0.4);
  }

  .btn-loan-add {
    background: linear-gradient(135deg, #10b981, #059669);
    color: #ffffff;
    box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
  }

  .btn-loan-add:hover {
    transform: translateZ(10px) translateY(-3px);
    box-shadow: 0 15px 35px rgba(16, 185, 129, 0.4);
    color: #ffffff;
  }

  /* Summary Cards Section */
  .loan-stats-section {
    margin-bottom: 30px;
  }

  .loan-stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    overflow-x: auto;
  }

  .loan-stat-card {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(248, 250, 252, 0.8) 100%);
    backdrop-filter: blur(15px);
    border-radius: 14px;
    padding: 18px 15px;
    box-shadow: 
      0 8px 20px rgba(0, 0, 0, 0.06),
      0 4px 12px rgba(0, 0, 0, 0.04),
      inset 0 1px 0 rgba(255, 255, 255, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.3);
    transform: translateZ(3px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    min-width: 0;
  }

  .loan-stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 3px;
    border-radius: 14px 14px 0 0;
    transition: all 0.3s ease;
  }

  .loan-stat-card:hover {
    transform: translateZ(8px) translateY(-5px);
    box-shadow: 
      0 15px 35px rgba(0, 0, 0, 0.1),
      0 8px 20px rgba(0, 0, 0, 0.06),
      inset 0 1px 0 rgba(255, 255, 255, 0.8);
  }

  .loan-stat-card-body {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    text-align: center;
  }

  .loan-stat-icon-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 45px;
    height: 45px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transform: translateZ(3px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }

  .loan-stat-icon-wrapper::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.6s ease;
  }

  .loan-stat-card:hover .loan-stat-icon-wrapper {
    transform: translateZ(6px) scale(1.05);
  }

  .loan-stat-card:hover .loan-stat-icon-wrapper::before {
    left: 100%;
  }

  .loan-stat-icon {
    font-size: 20px;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
  }

  .loan-stat-content {
    flex: 1;
    min-width: 0;
  }

  .loan-stat-content h6 {
    font-family: 'Roboto', sans-serif;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
    opacity: 0.8;
    line-height: 1.2;
  }

  .loan-stat-content h4 {
    font-family: 'Roboto', sans-serif;
    font-size: 18px;
    font-weight: 700;
    margin: 0;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    line-height: 1.2;
    word-break: break-word;
  }

  /* Color-specific styling for loan stats */
  .loan-stat-card-primary::before { background: linear-gradient(90deg, #3b82f6, #60a5fa); }
  .loan-stat-card-primary .loan-stat-icon-wrapper { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
  .loan-stat-card-primary .loan-stat-icon { color: #ffffff; }
  .loan-stat-card-primary .loan-stat-content h6 { color: #3b82f6; }
  .loan-stat-card-primary .loan-stat-content h4 { color: #1e40af; }

  .loan-stat-card-success::before { background: linear-gradient(90deg, #10b981, #059669); }
  .loan-stat-card-success .loan-stat-icon-wrapper { background: linear-gradient(135deg, #10b981, #059669); }
  .loan-stat-card-success .loan-stat-icon { color: #ffffff; }
  .loan-stat-card-success .loan-stat-content h6 { color: #10b981; }
  .loan-stat-card-success .loan-stat-content h4 { color: #065f46; }

  .loan-stat-card-warning::before { background: linear-gradient(90deg, #f59e0b, #d97706); }
  .loan-stat-card-warning .loan-stat-icon-wrapper { background: linear-gradient(135deg, #f59e0b, #d97706); }
  .loan-stat-card-warning .loan-stat-icon { color: #ffffff; }
  .loan-stat-card-warning .loan-stat-content h6 { color: #f59e0b; }
  .loan-stat-card-warning .loan-stat-content h4 { color: #92400e; }

  .loan-stat-card-danger::before { background: linear-gradient(90deg, #ef4444, #dc2626); }
  .loan-stat-card-danger .loan-stat-icon-wrapper { background: linear-gradient(135deg, #ef4444, #dc2626); }
  .loan-stat-card-danger .loan-stat-icon { color: #ffffff; }
  .loan-stat-card-danger .loan-stat-content h6 { color: #ef4444; }
  .loan-stat-card-danger .loan-stat-content h4 { color: #991b1b; }

  /* Filter Section - Hidden by default, shows below stats */
  .loan-filter-section {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(147, 197, 253, 0.05));
    border-radius: 16px;
    padding: 25px;
    border: 1px solid rgba(59, 130, 246, 0.1);
    position: relative;
    overflow: hidden;
    margin-bottom: 20px;
    max-height: 0;
    opacity: 0;
    transform: translateY(-20px);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .loan-filter-section.show {
    max-height: 500px;
    opacity: 1;
    transform: translateY(0);
    margin-bottom: 30px;
  }

  .loan-filter-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, #3b82f6, #60a5fa, #93c5fd);
    border-radius: 16px 16px 0 0;
  }

  .loan-filter-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px;
    align-items: end;
  }

  .loan-filter-group {
    position: relative;
  }

  .loan-filter-label {
    font-family: 'Roboto', sans-serif;
    font-size: 11px;
    font-weight: 600;
    color: #475569;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .loan-filter-label::before {
    content: '';
    width: 3px;
    height: 3px;
    background: #3b82f6;
    border-radius: 50%;
    box-shadow: 0 0 4px rgba(59, 130, 246, 0.5);
  }

  .form-control-loan-dashboard,
  .form-select-loan-dashboard {
    font-family: 'Roboto', sans-serif;
    font-size: 12px;
    padding: 12px 16px;
    border: 2px solid rgba(59, 130, 246, 0.1);
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.9);
    color: #1e40af;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.05);
    transform: translateZ(2px);
  }

  .form-control-loan-dashboard:focus,
  .form-select-loan-dashboard:focus {
    outline: none;
    border-color: #3b82f6;
    background: rgba(255, 255, 255, 1);
    box-shadow: 
      0 0 0 3px rgba(59, 130, 246, 0.1),
      0 8px 20px rgba(59, 130, 246, 0.15);
    transform: translateZ(5px) translateY(-2px);
  }

  .form-control-loan-dashboard:hover,
  .form-select-loan-dashboard:hover {
    border-color: rgba(59, 130, 246, 0.3);
    transform: translateZ(3px);
  }

  .btn-loan-reset {
    font-family: 'Roboto', sans-serif;
    font-size: 11px;
    font-weight: 600;
    padding: 12px 20px;
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    color: #ffffff;
    border: none;
    border-radius: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
    transform: translateZ(2px);
    position: relative;
    overflow: hidden;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 100%;
  }

  .btn-loan-reset::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.6s ease;
  }

  .btn-loan-reset:hover {
    transform: translateZ(5px) translateY(-2px);
    box-shadow: 0 12px 30px rgba(59, 130, 246, 0.4);
    color: #ffffff;
    text-decoration: none;
  }

  .btn-loan-reset:hover::before {
    left: 100%;
  }

  /* Mobile Responsiveness */
  @media (max-width: 1200px) {
    .loan-stats-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
  }

  @media (max-width: 768px) {
    .loan-card-content {
      padding: 25px 20px;
    }

    .loan-header-section {
      flex-direction: column;
      align-items: stretch;
      gap: 20px;
      margin-bottom: 25px;
    }

    .loan-title-section {
      justify-content: center;
    }

    .loan-page-title {
      font-size: 24px;
    }

    .loan-title-icon-wrapper {
      width: 50px;
      height: 50px;
    }

    .loan-title-icon {
      font-size: 24px;
    }

    .loan-action-buttons {
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn-loan-dashboard {
      padding: 12px 20px;
      font-size: 11px;
      flex: 1;
      min-width: 120px;
    }

    .loan-stats-grid {
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .loan-stat-card {
      padding: 15px 12px;
    }

    .loan-stat-content h6 {
      font-size: 9px;
    }

    .loan-stat-content h4 {
      font-size: 16px;
    }

    .loan-filter-section {
      padding: 20px;
    }

    .loan-filter-row {
      grid-template-columns: 1fr;
      gap: 15px;
    }
  }

  /* Animations */
  @keyframes slideInUp {
    from {
      opacity: 0;
      transform: translateZ(0px) translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateZ(15px) translateY(0px);
    }
  }

  @keyframes gradientFlow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  @keyframes floatGlow {
    0%, 100% { 
      transform: translateY(0px) translateX(0px) rotate(0deg);
      opacity: 0.3;
    }
    50% { 
      transform: translateY(-30px) translateX(20px) rotate(180deg);
      opacity: 0.6;
    }
  }

  /* Staggered animations for stats */
  .loan-stat-card:nth-child(1) { animation: slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.1s both; }
  .loan-stat-card:nth-child(2) { animation: slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.15s both; }
  .loan-stat-card:nth-child(3) { animation: slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both; }
  .loan-stat-card:nth-child(4) { animation: slideInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.25s both; }
  

/* Import Roboto font */
@import url("https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap");

/* Table container styling */
.table-responsive {
  font-family: "Roboto", sans-serif;
  font-size: 12px;
  background: linear-gradient(135deg, #f8faff 0%, #e3f2fd 100%);
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  margin-bottom: 20px;
}

/* Main table styling */
.table {
  font-family: "Roboto", sans-serif;
  font-size: 12px;
  border-radius: 8px;
  overflow: hidden;
  border: none;
  margin-bottom: 0;
  background: white;
}

/* Table header styling */
.table-light {
  background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%) !important;
}

.table-light th {
  background: transparent !important;
  color: white !important;
  font-weight: 600;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 15px 12px;
  border: none !important;
  position: relative;
}

.table-light th::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, #42a5f5, #90caf9);
}

/* Table body row styling */
.table tbody tr {
  transition: all 0.3s ease;
  border: none;
}

.table tbody tr:nth-child(even) {
  background-color: #f8faff;
}

.table tbody tr:nth-child(odd) {
  background-color: #ffffff;
}

/* Hover effect */
.table-hover tbody tr:hover {
  background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%) !important;
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(25, 118, 210, 0.15);
}

/* Table cell styling */
.table tbody td {
  padding: 12px;
  border: none !important;
  vertical-align: middle;
  font-size: 12px;
  color: #333;
  font-weight: 400;
}

/* Borrower link styling */
.text-primary {
  color: #1976d2 !important;
  text-decoration: none;
  font-weight: 500;
  transition: all 0.2s ease;
  padding: 4px 8px;
  border-radius: 4px;
  display: inline-block;
}

.text-primary:hover {
  color: white !important;
  background: #1976d2;
  text-decoration: none;
  transform: scale(1.05);
}

/* Amount styling (3rd column) */
.table tbody td:nth-child(3) {
  font-weight: 600;
  color: #2e7d32;
  font-size: 13px;
}

/* Interest rate styling (4th column) */
.table tbody td:nth-child(4) {
  font-weight: 500;
}

.table tbody td:nth-child(4)::before {
  content: "";
  background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
  padding: 4px 10px;
  border-radius: 15px;
  font-size: 11px;
  font-weight: 500;
  border: 1px solid #90caf9;
  color: #1565c0;
  margin-right: 5px;
}

/* Date styling (5th column) */
.table tbody td:nth-child(5) {
  color: #666;
  font-weight: 400;
}

/* Interest paid styling (6th column) */
.table tbody td:nth-child(6) {
  color: #f57c00;
  font-weight: 600;
}

/* Remaining balance styling (7th column) */
.table tbody td:nth-child(7) {
  color: #d32f2f;
  font-weight: 600;
  font-size: 13px;
}

/* Button styling */
.btn-sm {
  padding: 6px 10px;
  margin: 0 3px;
  border-radius: 6px;
  transition: all 0.2s ease;
  font-size: 11px;
  border-width: 1.5px;
}

.btn-outline-primary {
  border-color: #1976d2;
  color: #1976d2;
  background: white;
}

.btn-outline-primary:hover {
  background: #1976d2 !important;
  border-color: #1976d2 !important;
  color: white !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);
}

.btn-outline-success {
  border-color: #388e3c;
  color: #388e3c;
  background: white;
}

.btn-outline-success:hover {
  background: #388e3c !important;
  border-color: #388e3c !important;
  color: white !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(56, 142, 60, 0.3);
}

.btn-outline-danger {
  border-color: #d32f2f;
  color: #d32f2f;
  background: white;
}

.btn-outline-danger:hover {
  background: #d32f2f !important;
  border-color: #d32f2f !important;
  color: white !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(211, 47, 47, 0.3);
}

/* Icon styling */
.bi {
  font-size: 12px;
}

/* Shadow enhancement */
.shadow-sm {
  box-shadow: 0 4px 25px rgba(0, 0, 0, 0.1) !important;
}

/* Responsive design */
@media (max-width: 768px) {
  .table-responsive {
    padding: 15px;
    font-size: 11px;
  }

  .table {
    font-size: 11px;
  }

  .table-light th,
  .table tbody td {
    padding: 8px 6px;
    font-size: 10px;
  }

  .btn-sm {
    padding: 4px 6px;
    margin: 0 1px;
    font-size: 9px;
  }

  .text-primary {
    padding: 2px 4px;
  }
}

@media (max-width: 576px) {
  .table-responsive {
    padding: 10px;
    font-size: 10px;
  }

  .table {
    font-size: 10px;
  }

  .table-light th,
  .table tbody td {
    padding: 6px 4px;
    font-size: 9px;
  }

  .btn-sm {
    padding: 3px 5px;
    font-size: 8px;
  }

  .bi {
    font-size: 10px;
  }
}

/* Print styles */
@media print {
  .table-responsive {
    background: white !important;
    box-shadow: none !important;
    padding: 0 !important;
  }

  .table-hover tbody tr:hover {
    background: transparent !important;
    transform: none !important;
    box-shadow: none !important;
  }

  .btn-sm {
    display: none !important;
  }

  .table-light {
    background: #f8f9fa !important;
  }

  .table-light th {
    color: #333 !important;
  }
}


  
</style>

<div class="loan-management-container">
  <!-- Single Main Card Container -->
  <div class="loan-management-card">
    <div class="loan-card-content">
      
      <!-- Header Section -->
      <div class="loan-header-section">
        <!-- Left side: Title + Icon -->
        <div class="loan-title-section">
          <div class="loan-title-icon-wrapper">
            <i class="bi bi-cash-coin loan-title-icon"></i>
          </div>
          <h2 class="loan-page-title">LOAN MANAGEMENT</h2>
        </div>

        <!-- Right side: Action buttons -->
        <div class="loan-action-buttons">
          <a href="{% url 'download_loan_pdf' %}" class="btn-loan-dashboard btn-loan-pdf">
            <i class="bi bi-file-earmark-pdf-fill"></i> Download PDF
          </a>
          <button id="toggleFilterBtn" class="btn-loan-dashboard btn-loan-filter">
            <i class="bi bi-funnel-fill"></i> <span id="filterBtnText">Show Filters</span>
          </button>
          <button class="btn-loan-dashboard btn-loan-add" data-bs-toggle="modal" data-bs-target="#addLoanModal">
            <i class="bi bi-plus-circle"></i> Add New Loan
          </button>
        </div>
      </div>

      <!-- Summary Stats Section -->
      <div class="loan-stats-section">
        <div class="loan-stats-grid">
          <!-- Total Loaned Amount -->
          <div class="loan-stat-card loan-stat-card-primary">
            <div class="loan-stat-card-body">
              <div class="loan-stat-icon-wrapper">
                <i class="bi bi-wallet2 loan-stat-icon"></i>
              </div>
              <div class="loan-stat-content">
                <h6>Total Loaned Amount</h6>
                <h4>₹{{ total_loaned_amount|floatformat:2 }}</h4>
              </div>
            </div>
          </div>

          <!-- Total Principal Repaid -->
          <div class="loan-stat-card loan-stat-card-success">
            <div class="loan-stat-card-body">
              <div class="loan-stat-icon-wrapper">
                <i class="bi bi-arrow-down-circle-fill loan-stat-icon"></i>
              </div>
              <div class="loan-stat-content">
                <h6>Total Principal Repaid</h6>
                <h4>₹{{ total_principal_repaid|floatformat:2 }}</h4>
              </div>
            </div>
          </div>

          <!-- Total Interest Collected -->
          <div class="loan-stat-card loan-stat-card-warning">
            <div class="loan-stat-card-body">
              <div class="loan-stat-icon-wrapper">
                <i class="bi bi-percent loan-stat-icon"></i>
              </div>
              <div class="loan-stat-content">
                <h6>Total Interest Collected</h6>
                <h4>₹{{ total_interest_collected|floatformat:2 }}</h4>
              </div>
            </div>
          </div>

          <!-- Total Outstanding Principal -->
          <div class="loan-stat-card loan-stat-card-danger">
            <div class="loan-stat-card-body">
              <div class="loan-stat-icon-wrapper">
                <i class="bi bi-exclamation-triangle-fill loan-stat-icon"></i>
              </div>
              <div class="loan-stat-content">
                <h6>Total Outstanding Principal</h6>
                <h4>₹{{ total_outstanding|floatformat:2 }}</h4>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Filter Section - Hidden by default, shows below stats when toggled -->
      <div id="loanFilterSection" class="loan-filter-section">
        <form id="loanFilterForm" method="get">
          <div class="loan-filter-row">
            <div class="loan-filter-group">
              <label class="loan-filter-label">
                <i class="bi bi-folder"></i>
                Project
              </label>
              <select name="project" class="form-select-loan-dashboard live-filter">
                <option value="">All Projects</option>
                {% for project in projects %}
                <option value="{{ project.id }}" {% if request.GET.project == project.id|stringformat:"s" %}selected{% endif %}>{{ project.name }}</option>
                {% endfor %}
              </select>
            </div>
            
            <div class="loan-filter-group">
              <label class="loan-filter-label">
                <i class="bi bi-currency-rupee"></i>
                Loan Amount ≥
              </label>
              <input type="number" name="loan_amount" class="form-control-loan-dashboard live-filter" value="{{ request.GET.loan_amount }}" placeholder="Min amount">
            </div>
            
            <div class="loan-filter-group">
              <label class="loan-filter-label">
                <i class="bi bi-wallet"></i>
                Balance ≤
              </label>
              <input type="number" name="balance" class="form-control-loan-dashboard live-filter" value="{{ request.GET.balance }}" placeholder="Max balance">
            </div>
            
            <div class="loan-filter-group">
              <label class="loan-filter-label">
                <i class="bi bi-calendar-event"></i>
                Start Date
              </label>
              <input type="date" name="start_date" class="form-control-loan-dashboard live-filter" value="{{ request.GET.start_date }}">
            </div>
            
            <div class="loan-filter-group">
              <label class="loan-filter-label">
                <i class="bi bi-calendar-check"></i>
                End Date
              </label>
              <input type="date" name="end_date" class="form-control-loan-dashboard live-filter" value="{{ request.GET.end_date }}">
            </div>
            
            <div class="loan-filter-group">
              <label class="loan-filter-label">
                <i class="bi bi-percent"></i>
                Interest Rate
              </label>
              <input type="number" step="0.01" name="interest_rate" class="form-control-loan-dashboard live-filter" value="{{ request.GET.interest_rate }}" placeholder="Rate %">
            </div>
            
            <div class="loan-filter-group">
              <a href="{% url 'loan_list' %}" class="btn-loan-reset">
                <i class="bi bi-arrow-clockwise me-1"></i>
                Reset Filters
              </a>
            </div>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>


<!-- Loan Table -->
<div class="table-responsive">
  <table class="table table-hover shadow-sm">
    <thead class="table-light">
      <tr>
        <th><i class="fas fa-user-tag"></i> Borrower</th>
        <th><i class="fas fa-project-diagram me-2"></i>Project / Purpose</th>
        <th><i class="fas fa-money-bill-wave"></i> <!-- flowing money -->
Loan Amount</th>
        <th><i class="fas fa-percent"></i> <!-- symbol for interest -->
Interest Rate</th>
        <th><i class="fas fa-calendar-alt"></i> <!-- General date -->
Start Date</th>
        <th><i class="fas fa-coins"></i> <!-- symbolizing payment -->
Total Interest Paid</th>
        <th><i class="fas fa-balance-scale-left"></i> <!-- metaphor for balance -->
Remaining Balance</th>
        <th><i class="fas fa-tools"></i>
Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for loan in loans %}
      <tr>
        <td><a href="#" class="text-primary" data-bs-toggle="modal" data-bs-target="#viewLoanModal{{ loan.id }}">{{ loan.project }}</a></td>
        <td>{{ loan.loan_purpose }}</td>
        <td>${{ loan.amount|floatformat:2 }}</td>
        <td>{{ loan.interest_rate|floatformat:2 }}%</td>
        <td>{{ loan.start_date }}</td>
        <td>${{ loan.total_interest_paid|default:"0.00"|floatformat:2 }}</td>
        <td>${{ loan.remaining_balance|default:"0.00"|floatformat:2 }}</td>
        <td>
          <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editLoanModal{{ loan.id }}">
             <i class="bi bi-pencil-square"></i>
          </button>
          <a href="{% url 'loan_detail' loan.id %}" class="btn btn-sm btn-outline-success">
              <i class="bi bi-eye"></i>
          </a>
          <button class="btn btn-sm btn-outline-danger" onclick="deleteLoan({{ loan.id }})">
             <i class="bi bi-trash"></i>
          </button>
        </td>
      </tr>

      <!-- Edit Modal -->
      <div class="modal fade" id="editLoanModal{{ loan.id }}" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <form method="post" action="{% url 'update_loan' loan.id %}" enctype="multipart/form-data">
              {% csrf_token %}
              <div class="modal-header">
                <h5 class="modal-title">Edit Loan - {{ loan.loan_id }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
  <div class="mb-3">
    <label class="form-label">Loan ID</label>
    {{ loan.get_form.loan_id }}
  </div>
  <div class="mb-3">
    <label class="form-label">Project</label>
    {{ loan.get_form.project }}
  </div>
  <div class="mb-3">
    <label class="form-label">Amount</label>
    {{ loan.get_form.amount }}
  </div>
  <div class="mb-3">
    <label class="form-label">Interest Rate (%)</label>
    {{ loan.get_form.interest_rate }}
  </div>
  <div class="mb-3">
    <label class="form-label">Start Date</label>
    {{ loan.get_form.start_date }}
  </div>
  <div class="mb-3">
    <label class="form-label">Loan Purpose</label>
    {{ loan.get_form.loan_purpose }}
  </div>

  <div class="mb-3">
    <label class="form-label">Payment Proof</label>
    {% if loan.payment_proof %}
      <div class="mb-2">
        <a href="{{ loan.payment_proof.url }}" target="_blank" class="btn btn-sm btn-outline-info">
          View Existing File
        </a>
      </div>
    {% endif %}
    {{ loan.get_form.payment_proof }}
  </div>
</div>

              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Save changes</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- View Modal -->
      <div class="modal fade" id="viewLoanModal{{ loan.id }}" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content p-3">
            <div class="modal-header">
              <h5 class="modal-title">Loan Details</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <p><strong>Borrower:</strong> {{ loan.project.borrower_name }}</p>
              <p><strong>Project:</strong> {{ loan.project.name }}</p>
              <p><strong>Loan Amount:</strong> ${{ loan.amount|floatformat:2 }}</p>
              <p><strong>Interest Rate:</strong> {{ loan.interest_rate|floatformat:2 }}%</p>
              <p><strong>Purpose:</strong> {{ loan.loan_purpose }}</p>
              <p><strong>Start Date:</strong> {{ loan.start_date }}</p>
              {% if loan.payment_proof %}
  <p><strong>Payment Proof:</strong> 
    <a href="{{ loan.payment_proof.url }}" target="_blank" class="btn btn-sm btn-outline-info">
      View File
    </a>
  </p>
{% else %}
  <p><strong>Payment Proof:</strong> Not uploaded</p>
{% endif %}

            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Add Modal -->
<!-- Blue & White Styled Add Loan Modal -->
<div class="modal fade" id="addLoanModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form method="post" action="{% url 'create_loan' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="d-flex">
          <!-- Blue Side -->
          <div class="p-4 bg-primary text-white d-flex flex-column justify-content-between" style="width: 35%; border-top-left-radius: .5rem; border-bottom-left-radius: .5rem;">
            <div>
              <i class="fas fa-university fa-3x mb-3"></i>
              <h5 class="fw-bold">New Loan</h5>
              <p style="font-size: 14px;">Register a loan with full details</p>
            </div>
            <img src=" " alt="Loan Icon" class="img-fluid mt-auto" style="max-height: 80px;">
          </div>

          <!-- White Form Side -->
          <div class="p-4 bg-white rounded-end w-100">
            <h5 class="mb-4 fw-bold text-primary">Loan Details</h5>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="id_loan_id" class="form-label">Loan ID</label>
                {{ form.loan_id }}
              </div>
              <div class="col-md-6 mb-3">
                <label for="id_project" class="form-label">Project</label>
                {{ form.project }}
              </div>
              <div class="col-md-6 mb-3">
                <label for="id_amount" class="form-label">Amount</label>
                {{ form.amount }}
              </div>
              <div class="col-md-6 mb-3">
                <label for="id_interest_rate" class="form-label">Interest Rate (%)</label>
                {{ form.interest_rate }}
              </div>
              <div class="col-md-6 mb-3">
  <label for="{{ form.payment_proof.id_for_label }}" class="form-label">Payment Proof</label>
  {{ form.payment_proof }}
</div>

              <div class="col-md-6 mb-3">
                <label for="id_start_date" class="form-label">Start Date</label>
                {{ form.start_date }}
              </div>
              {% comment %} <div class="col-md-6 mb-3">
                <label for="id_repayment_date" class="form-label">Repayment Date</label>
                {{ form.repayment_date }}
              </div> {% endcomment %}
              <div class="col-12 mb-3">
                <label for="id_purpose" class="form-label">Loan Purpose</label>
                {{ form.loan_purpose }}
              </div>
            </div>

            <!-- Buttons -->
            <div class="d-flex justify-content-end gap-2 mt-3">
              <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary text-white">Add Loan</button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  function deleteLoan(id) {
    if (confirm('Are you sure you want to delete this loan?')) {
      fetch("{% url 'delete_loan' %}", {
        method: 'POST',
        headers: {
          'X-CSRFToken': '{{ csrf_token }}',
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: `loan_id=${id}`
      }).then(response => response.json())
      .then(data => {
        if (data.success) {
          location.reload();
        } else {
          alert('Error: ' + data.message);
        }
      });
    }
  }
</script>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function () {
    $('.live-filter').on('input change', function () {
      clearTimeout(window._filterDelay);
      window._filterDelay = setTimeout(function () {
      
      }, 300);
    });
  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const filterForm = document.getElementById('loanFilterForm');
    const rows = document.querySelectorAll("table tbody tr");

    // Filter fields
    const projectFilter = filterForm.querySelector('[name="project"]');
    const amountFilter = filterForm.querySelector('[name="loan_amount"]');
    const balanceFilter = filterForm.querySelector('[name="balance"]');
    const dateFilter = filterForm.querySelector('[name="start_date"]');
    const interestFilter = filterForm.querySelector('[name="interest_rate"]');

    function applyFilters() {
      rows.forEach(row => {
        const cells = row.children;
        const projectText = cells[0].innerText.trim().toLowerCase();
        const purposeText = cells[1].innerText.trim().toLowerCase();
        const amount = parseFloat(cells[2].innerText.replace(/[₹$,]/g, '')) || 0;
        const balance = parseFloat(cells[6].innerText.replace(/[₹$,]/g, '')) || 0;
        const startDate = cells[4].innerText.trim();
        const interest = parseFloat(cells[3].innerText.replace('%', '')) || 0;

        const match =
          (!projectFilter.value || projectText.includes(projectFilter.options[projectFilter.selectedIndex].text.toLowerCase())) &&
          (!amountFilter.value || amount >= parseFloat(amountFilter.value)) &&
          (!balanceFilter.value || balance <= parseFloat(balanceFilter.value)) &&
          (!dateFilter.value || new Date(startDate) >= new Date(dateFilter.value)) &&
          (!interestFilter.value || interest >= parseFloat(interestFilter.value));

        row.style.display = match ? '' : 'none';
      });
    }

    [projectFilter, amountFilter, balanceFilter, dateFilter, interestFilter].forEach(input => {
      input.addEventListener('input', applyFilters);
      input.addEventListener('change', applyFilters);
    });
  });
</script>



<script>
// Enhanced interactions
document.addEventListener('DOMContentLoaded', function() {
  const toggleFilterBtn = document.getElementById('toggleFilterBtn');
  const filterSection = document.getElementById('loanFilterSection');
  const filterBtnText = document.getElementById('filterBtnText');
  const actionButtons = document.querySelectorAll('.btn-loan-dashboard');
  
  // Toggle filter section
  toggleFilterBtn.addEventListener('click', function() {
    const isVisible = filterSection.classList.contains('show');
    
    if (isVisible) {
      // Hide filters
      filterSection.classList.remove('show');
      filterBtnText.textContent = 'Show Filters';
      this.classList.remove('active');
      this.innerHTML = '<i class="bi bi-funnel-fill"></i> <span id="filterBtnText">Show Filters</span>';
    } else {
      // Show filters
      filterSection.classList.add('show');
      filterBtnText.textContent = 'Hide Filters';
      this.classList.add('active');
      this.innerHTML = '<i class="bi bi-funnel-fill"></i> <span id="filterBtnText">Hide Filters</span>';
    }
  });
  
  // Ripple effect for all action buttons
  actionButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      // Skip ripple for filter toggle to avoid interference
      if (this.id === 'toggleFilterBtn') return;
      
      const ripple = document.createElement('span');
      const rect = this.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      const x = e.clientX - rect.left - size / 2;
      const y = e.clientY - rect.top - size / 2;
      
      ripple.style.cssText = `
        position: absolute;
        width: ${size}px;
        height: ${size}px;
        left: ${x}px;
        top: ${y}px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        transform: scale(0);
        animation: ripple 0.6s ease-out;
        pointer-events: none;
      `;
      
      this.appendChild(ripple);
      
      setTimeout(() => {
        ripple.remove();
      }, 600);
    });
  });

  // Auto-submit filters when changed
  const filterInputs = document.querySelectorAll('.live-filter');
  filterInputs.forEach(input => {
    input.addEventListener('change', function() {
      document.getElementById('loanFilterForm').submit();
    });
  });

  // Add CSS for ripple animation
  const style = document.createElement('style');
  style.textContent = `
    @keyframes ripple {
      to {
        transform: scale(2);
        opacity: 0;
      }
    }
  `;
  document.head.appendChild(style);
});

// Enhanced card interactions
document.addEventListener('DOMContentLoaded', function() {
  const mainCard = document.querySelector('.loan-management-card');
  const statCards = document.querySelectorAll('.loan-stat-card');
  const filterInputs = document.querySelectorAll('.form-control-loan-dashboard, .form-select-loan-dashboard');

  // Add parallax effect to main card
  mainCard.addEventListener('mousemove', function(e) {
    const rect = this.getBoundingClientRect();
    const x = (e.clientX - rect.left) / rect.width;
    const y = (e.clientY - rect.top) / rect.height;
    
    const moveX = (x - 0.5) * 8;
    const moveY = (y - 0.5) * 8;
    
    this.style.transform = `translateZ(20px) translateX(${moveX}px) translateY(${moveY}px)`;
  });
  
  mainCard.addEventListener('mouseleave', function() {
    this.style.transform = 'translateZ(15px)';
  });

  // Enhanced stat card interactions
  statCards.forEach((card, index) => {
    card.addEventListener('mouseenter', function() {
      this.style.transform = 'translateZ(8px) translateY(-5px) rotateX(3deg)';
    });
    
    card.addEventListener('mouseleave', function() {
      this.style.transform = 'translateZ(3px) translateY(0px) rotateX(0deg)';
    });

    card.addEventListener('click', function() {
      this.style.transform = 'translateZ(12px) translateY(-8px) scale(1.02)';
      setTimeout(() => {
        this.style.transform = 'translateZ(8px) translateY(-5px) scale(1)';
      }, 200);
    });
  });

  // Enhanced filter input interactions
  filterInputs.forEach(input => {
    input.addEventListener('focus', function() {
      this.parentElement.style.transform = 'translateZ(3px)';
    });
    
    input.addEventListener('blur', function() {
      this.parentElement.style.transform = 'translateZ(0px)';
    });
  });
});
</script>
{% endblock %}